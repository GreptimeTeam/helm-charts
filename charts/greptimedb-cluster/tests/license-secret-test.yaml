suite: license-secret tests
templates:
  - license-secret.yaml
tests:
  - it: should not create secret when license is disabled
    set:
      license:
        enabled: false
    asserts:
      - hasDocuments:
          count: 0

  - it: should not create secret when existingSecretName is provided
    set:
      license:
        enabled: true
        existingSecretName: my-existing-license
    asserts:
      - hasDocuments:
          count: 0

  - it: should create secret with default name when license is enabled
    release:
      name: mycluster
    set:
      license:
        enabled: true
        data: |
          license-key-content-here
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: metadata.name
          value: mycluster-license

  - it: should create secret with custom secretName
    set:
      license:
        enabled: true
        secretName: custom-license-secret
        data: |
          license-key-content-here
    asserts:
      - equal:
          path: metadata.name
          value: custom-license-secret

  - it: should use correct mount file name in secret data
    set:
      license:
        enabled: true
        mountFileName: license.txt
        data: |
          my-license-data
    asserts:
      - isKind:
          of: Secret
      - isNotNull:
          path: stringData["license.txt"]
