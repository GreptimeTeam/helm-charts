suite: object-storage-secret tests
templates:
  - object-storage-secret.yaml
tests:
  - it: should not create secret when objectStorage is not configured
    asserts:
      - hasDocuments:
          count: 0

  - it: should not create secret when credentials are not configured
    set:
      objectStorage:
        s3:
          bucket: my-bucket
          region: us-west-2
    asserts:
      - hasDocuments:
          count: 0

  - it: should not create secret when existingSecretName is provided
    set:
      objectStorage:
        s3:
          bucket: my-bucket
          region: us-west-2
        credentials:
          existingSecretName: my-existing-secret
    asserts:
      - hasDocuments:
          count: 0

  - it: should create secret with S3 credentials (accessKeyId and secretAccessKey)
    set:
      objectStorage:
        s3:
          bucket: my-bucket
          region: us-west-2
        credentials:
          accessKeyId: my-access-key
          secretAccessKey: my-secret-key
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: metadata.name
          value: storage-credentials
      - equal:
          path: stringData.access-key-id
          value: my-access-key
      - equal:
          path: stringData.secret-access-key
          value: my-secret-key

  - it: should create secret with custom secretName
    set:
      objectStorage:
        s3:
          bucket: my-bucket
        credentials:
          secretName: custom-secret-name
          accessKeyId: my-access-key
          secretAccessKey: my-secret-key
    asserts:
      - equal:
          path: metadata.name
          value: custom-secret-name

  - it: should create secret with OSS credentials (accessKeyId and accessKeySecret)
    set:
      objectStorage:
        oss:
          bucket: my-bucket
          region: cn-hangzhou
        credentials:
          accessKeyId: my-access-key
          accessKeySecret: my-access-key-secret
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: stringData.access-key-id
          value: my-access-key
      - equal:
          path: stringData.access-key-secret
          value: my-access-key-secret

  - it: should create secret with Azure credentials (accountName and accountKey)
    set:
      objectStorage:
        azblob:
          container: my-container
        credentials:
          accountName: my-account
          accountKey: my-account-key
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: stringData.account-name
          value: my-account
      - equal:
          path: stringData.account-key
          value: my-account-key

  - it: should create secret with GCS credentials (serviceAccountKey as base64)
    set:
      objectStorage:
        gcs:
          bucket: my-bucket
        credentials:
          serviceAccountKey: eyJrZXkiOiJ2YWx1ZSJ9
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: data.service-account-key
          value: eyJrZXkiOiJ2YWx1ZSJ9
